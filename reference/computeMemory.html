<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Quantifies ecological memory with Random Forest. — computeMemory • memoria</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quantifies ecological memory with Random Forest. — computeMemory"><meta name="description" content="Takes the output of prepareLaggedData to fit the following model with Random Forest:
\(p_{t} = p_{t-1} +...+ p_{t-n} + d_{t} + d_{t-1} +...+ d_{t-n} + r\)
where:

\(d\) is a driver (several drivers can be added).
\(t\) is the time of any given value of the response p.
\(t-1\) is the lag number 1 (in time units).
\(p_{t-1} +...+ p_{t-n}\)  represents the endogenous component of ecological memory.
\(d_{t-1} +...+ d_{t-n}\)  represents the exogenous component of ecological memory.
\(d_{t}\) represents the concurrent effect of the driver over the response.
\(r\) represents a column of random values, used to test the significance of the variable importance scores returned by Random Forest.

"><meta property="og:description" content="Takes the output of prepareLaggedData to fit the following model with Random Forest:
\(p_{t} = p_{t-1} +...+ p_{t-n} + d_{t} + d_{t-1} +...+ d_{t-n} + r\)
where:

\(d\) is a driver (several drivers can be added).
\(t\) is the time of any given value of the response p.
\(t-1\) is the lag number 1 (in time units).
\(p_{t-1} +...+ p_{t-n}\)  represents the endogenous component of ecological memory.
\(d_{t-1} +...+ d_{t-n}\)  represents the exogenous component of ecological memory.
\(d_{t}\) represents the concurrent effect of the driver over the response.
\(r\) represents a column of random values, used to test the significance of the variable importance scores returned by Random Forest.

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">memoria</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Quantifies ecological memory with Random Forest.</h1>

      <div class="d-none name"><code>computeMemory.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Takes the output of <code><a href="prepareLaggedData.html">prepareLaggedData</a></code> to fit the following model with Random Forest:</p>
<p>\(p_{t} = p_{t-1} +...+ p_{t-n} + d_{t} + d_{t-1} +...+ d_{t-n} + r\)</p>
<p>where:</p>
<ul><li><p>\(d\) is a driver (several drivers can be added).</p></li>
<li><p>\(t\) is the time of any given value of the response <em>p</em>.</p></li>
<li><p>\(t-1\) is the lag number 1 (in time units).</p></li>
<li><p>\(p_{t-1} +...+ p_{t-n}\)  represents the endogenous component of ecological memory.</p></li>
<li><p>\(d_{t-1} +...+ d_{t-n}\)  represents the exogenous component of ecological memory.</p></li>
<li><p>\(d_{t}\) represents the concurrent effect of the driver over the response.</p></li>
<li><p>\(r\) represents a column of random values, used to test the significance of the variable importance scores returned by Random Forest.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">computeMemory</span><span class="op">(</span></span>
<span>  lagged.data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  response <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  drivers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random.mode <span class="op">=</span> <span class="st">"autocorrelated"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  subset.response <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  min.node.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  num.trees <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  mtry <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num.threads <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-lagged-data">lagged.data<a class="anchor" aria-label="anchor" href="#arg-lagged-data"></a></dt>
<dd><p>a lagged dataset resulting from <code><a href="prepareLaggedData.html">prepareLaggedData</a></code>. See <code><a href="palaeodataLagged.html">palaeodataLagged</a></code> as example.</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>character string, name of the response variable. Not required if `lagged.data` was generated with [prepareLaggedData]. Default: NULL</p></dd>


<dt id="arg-drivers">drivers<a class="anchor" aria-label="anchor" href="#arg-drivers"></a></dt>
<dd><p>a character string or vector of character strings with variables to be used as predictors in the model. Not required if `lagged.data` was generated with [prepareLaggedData].. <strong>Important:</strong> <code>drivers</code> names must not have the character "__" (double underscore). Default: NULL</p></dd>


<dt id="arg-random-mode">random.mode<a class="anchor" aria-label="anchor" href="#arg-random-mode"></a></dt>
<dd><p>either "none", "white.noise" or "autocorrelated". See details.</p></dd>


<dt id="arg-repetitions">repetitions<a class="anchor" aria-label="anchor" href="#arg-repetitions"></a></dt>
<dd><p>integer, number of random forest models to fit.</p></dd>


<dt id="arg-subset-response">subset.response<a class="anchor" aria-label="anchor" href="#arg-subset-response"></a></dt>
<dd><p>character string with values "up", "down" or "none", triggers the subsetting of the input dataset. "up" only models memory on cases where the response's trend is positive, "down" selects cases with negative trends, and "none" selects all cases.</p></dd>


<dt id="arg-min-node-size">min.node.size<a class="anchor" aria-label="anchor" href="#arg-min-node-size"></a></dt>
<dd><p>integer, argument of the <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> function. Minimal number of samples to be allocated in a terminal node. Default is 5.</p></dd>


<dt id="arg-num-trees">num.trees<a class="anchor" aria-label="anchor" href="#arg-num-trees"></a></dt>
<dd><p>integer, argument of the <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> function. Number of regression trees to be fitted (size of the forest). Default is 500</p></dd>


<dt id="arg-mtry">mtry<a class="anchor" aria-label="anchor" href="#arg-mtry"></a></dt>
<dd><p>integer, argument of the <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> function. Number of variables to possibly split at in each node. Default: NULL.</p></dd>


<dt id="arg-num-threads">num.threads<a class="anchor" aria-label="anchor" href="#arg-num-threads"></a></dt>
<dd><p>integer, number of cores <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> can use for multithreading. Default: 2</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with 5 slots:</p><ul><li><p><code>response</code> character, response variable name.</p></li>
<li><p><code>drivers</code> character vector, driver variable names.</p></li>
<li><p><code>memory</code> dataframe with six columns:</p><ul><li><p><code>median</code> numeric, median importance across <code>repetitions</code> of the given <code>variable</code> according to Random Forest.</p></li>
<li><p><code>sd</code> numeric, standard deviation of the importance values of the given <code>variable</code> across <code>repetitions</code>.</p></li>
<li><p><code>min</code> and <code>max</code> numeric, percentiles 0.05 and 0.95 of importance values of the given <code>variable</code> across <code>repetitions</code>.</p></li>
<li><p><code>variable</code> character, names of the different variables used to model ecological memory.</p></li>
<li><p><code>lag</code> numeric, time lag values.</p></li>
</ul></li>
<li><p><code>R2</code> vector, values of pseudo R-squared value obtained for the Random Forest model fitted on each repetition. Pseudo R-squared is the Pearson correlation between the observed and predicted data.</p></li>
<li><p><code>prediction</code> dataframe, with the same columns as the dataframe in the slot <code>memory</code>, with the median and confidence intervals of the predictions of all random forest models fitted.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses the <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> package to fit Random Forest models. Please, check the help of the <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> function to better understand how Random Forest is parameterized in this package. This function fits the model explained above as many times as defined in the argument <code>repetitions</code>.</p>
<p>To test the statistical significance of the variable importance scores returned by random forest, on each repetition the model is fitted with a different <code>r</code> (random) term, unless <code>random.mode = "none"</code>. If <code>random.mode</code> equals "autocorrelated", the random term will have a temporal autocorrelation, and if it equals "white.noise", it will be a pseudo-random sequence of numbers generated with <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></code>, with no temporal autocorrelation. The importance of the random sequence in predicting the response is stored for each model run, and used as a benchmark to assess the importance of the other predictors.</p>
<p>Importance values of other predictors that are above the median of the importance of the random term should be interpreted as non-random, and therefore, significant.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Wright, M. N. &amp; Ziegler, A. (2017). ranger: A fast implementation of random forests for high dimensional data in C++ and R. J Stat Softw 77:1-17. <a href="https://doi.org/10.18637/jss.v077.i01" class="external-link">https://doi.org/10.18637/jss.v077.i01</a>.</p></li>
<li><p>Breiman, L. (2001). Random forests. Mach Learn, 45:5-32. <a href="https://doi.org/10.1023/A:1010933404324" class="external-link">https://doi.org/10.1023/A:1010933404324</a>.</p></li>
<li><p>Hastie, T., Tibshirani, R., Friedman, J. (2009). The Elements of Statistical Learning. Springer, New York. 2nd edition.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plotMemory.html">plotMemory</a></code>, <code><a href="extractMemoryFeatures.html">extractMemoryFeatures</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Blas M. Benito  &lt;blasbenito@gmail.com&gt;</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">#loading data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">palaeodataLagged</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simplified call - response and drivers auto-detected from attributes</span></span></span>
<span class="r-in"><span><span class="va">memory.output</span> <span class="op">&lt;-</span> <span class="fu">computeMemory</span><span class="op">(</span></span></span>
<span class="r-in"><span> lagged.data <span class="op">=</span> <span class="va">palaeodataLagged</span>,</span></span>
<span class="r-in"><span> random.mode <span class="op">=</span> <span class="st">"autocorrelated"</span>,</span></span>
<span class="r-in"><span> repetitions <span class="op">=</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">memory.output</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ response  : chr "pollen.pinus"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ drivers   : chr [1:2] "climate.temperatureAverage" "climate.rainfallAverage"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ memory    :'data.frame':	23 obs. of  6 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ median  : num [1:23] 40 25 17.9 17.5 18.7 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ sd      : num [1:23] 0.941 0.498 0.631 1.063 1.615 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ min     : num [1:23] 39.6 24.4 17.2 16 16.5 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ max     : num [1:23] 42.1 25.8 18.9 19 21 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ variable: Factor w/ 4 levels "pollen.pinus",..: 1 1 1 1 1 2 2 2 2 2 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ lag     : num [1:23] 0.2 0.4 0.6 0.8 1 0 0.2 0.4 0.6 0.8 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ R2        : num [1:10] 0.991 0.991 0.991 0.991 0.991 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ prediction:'data.frame':	3988 obs. of  4 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ median: num [1:3988] 3.66 5.02 7.83 11.15 13.86 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ sd    : num [1:3988] 0.212 0.144 0.177 0.234 0.239 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ min   : num [1:3988] 3.35 4.86 7.56 10.86 13.77 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ max   : num [1:3988] 3.95 5.25 8.02 11.51 14.38 ...</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">memory.output</span><span class="op">$</span><span class="va">memory</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'data.frame':	23 obs. of  6 variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ median  : num  40 25 17.9 17.5 18.7 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ sd      : num  0.941 0.498 0.631 1.063 1.615 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ min     : num  39.6 24.4 17.2 16 16.5 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ max     : num  42.1 25.8 18.9 19 21 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ variable: Factor w/ 4 levels "pollen.pinus",..: 1 1 1 1 1 2 2 2 2 2 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ lag     : num  0.2 0.4 0.6 0.8 1 0 0.2 0.4 0.6 0.8 ...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#plotting output</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotMemory.html">plotMemory</a></span><span class="op">(</span>memory.output <span class="op">=</span> <span class="va">memory.output</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="computeMemory-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Blas M. Benito.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

