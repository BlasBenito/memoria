---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# memoria

  <!-- badges: start -->
[![CRAN_Release_Badge](http://www.r-pkg.org/badges/version-ago/memoria)](https://CRAN.R-project.org/package=memoria)
[![CRAN_Download_Badge](http://cranlogs.r-pkg.org/badges/grand-total/memoria)](https://CRAN.R-project.org/package=memoria)
[![R-CMD-check](https://github.com/blasbenito/memoria/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/blasbenito/memoria/actions/workflows/R-CMD-check.yaml)
 <!-- badges: end -->

The **memoria** package quantifies ecological memory in long time-series involving environmental drivers and biotic responses, including palaeoecological datasets. It uses Random Forest models to measure the relative importance of endogenous memory (effect of past response values), exogenous memory (effect of past driver values), and concurrent effects (synchronic driver influence).

## Installation

Install from CRAN:

```{r, eval = FALSE}
install.packages("memoria")
```

Or the development version from GitHub:

```{r, eval = FALSE}
devtools::install_github("BlasBenito/memoria")
```

## Quick Example

This minimal example uses built-in data to demonstrate the core workflow.

```{r, message = FALSE, warning = FALSE}
library(memoria)
library(distantia)
library(dplyr)
```


### Example Data

The `palaeodata` dataset contains is a palaeoecological dataset with pollen percentages for several taxa and several climate variables.

```{r}
data(palaeodata)
dplyr::glimpse(palaeodata)
```
For this example we select one of the plant species and two climate variables.

```{r, fig.width=8, fig.height=4}
df <- palaeodata |> 
  dplyr::transmute(
    pinus = pollen.pinus,
    temperature = climate.temperatureAverage,
    rain = climate.rainfallAverage,
    time = age
  )

df |>  
  distantia::tsl_init(
  time_column = "time"
) |> 
  distantia::tsl_plot(
    ylim = "relative",
    guide = FALSE
  )
```
Notice that in the plot above, time, in kilo years before present, goes from right (oldest) to left (newest).

Before to analyze ecological memory in this dataset, we need to build a lagged version in which each value of the response and the predictors (drivers) is matched with previous values.


```{r}
df_lags <- memoria::prepareLaggedData(
  input.data = df,
  response = "pinus",
  drivers = c(
    "temperature", 
    "rain"
    ),
  time = "time",
  oldest.sample = "last",
  lags = seq(from = 0.5, to = 10, by = 0.5)
)
```

Lets plot three of these lags.

```{r, fig.width=8, fig.height=4}
distantia::zoo_plot(
  x = zoo::zoo(
    x = df_lags[1:500, c("temperature_0", "temperature_5", "temperature_10")],
    order.by = df_lags$time[1:500]
  ),
  xlab = "Age (ka BP)"
)
```


### Ecological Memory Analysis

```{r example, message = FALSE, warning = FALSE}
memory_output <- computeMemory(
  lagged.data = palaeodataLagged,
  drivers = c(
    "climate.temperatureAverage", 
    "climate.rainfallAverage"
    ),
  response = "Response",
  add.random = TRUE,
  random.mode = "autocorrelated",
  repetitions = 100
)

# Plot the memory pattern
x <- plotMemory(memory_output)
```

The plot shows:

- **Violet curve**: Endogenous memory (effect of past pollen abundance)
- **Blue/green curves**: Exogenous memory (effect of past climate variables)
- **Yellow band**: Random benchmark for significance testing
- **Lag 0**: Concurrent effect of drivers

## Learn More

- **[Quick Start Guide](https://blasbenito.github.io/memoria/articles/quick_start.html)**: Full workflow from raw data to memory features
- **[Using memoria](https://blasbenito.github.io/memoria/articles/using_memoria.html)**: Detailed explanation of methods and theory
- **[Function Reference](https://blasbenito.github.io/memoria/reference/index.html)**: Documentation for all exported functions

## How to cite memoria

If you use **memoria** in your research, please cite both the package and the associated paper:

**Paper:**

> Benito, B.M., Gil-Romera, G., & Birks, H.J.B. (2020). Ecological memory at millennial time-scales: the importance of data constraints, species longevity, and niche features. *Ecography*, 43(1), 1-10. doi: [10.1111/ecog.04772](https://doi.org/10.1111/ecog.04772)

**R package:**

> Benito, B.M. (2025). memoria: Quantifying Ecological Memory in Palaeoecological Datasets and Other Long Time-Series. R package version 1.1.0. doi: [10.32614/CRAN.package.memoria](https://doi.org/10.32614/CRAN.package.memoria)
