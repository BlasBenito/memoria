<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with memoria • memoria</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with memoria">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">memoria</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with memoria</h1>
            
      

      <div class="d-none name"><code>working_with_memoria.Rmd</code></div>
    </div>

    
    
<p>This article walks through the complete memoria workflow for
quantifying ecological memory in time series data consisting of at least
one response and one predictor.</p>
<div class="section level2">
<h2 id="ecological-memory">Ecological Memory<a class="anchor" aria-label="anchor" href="#ecological-memory"></a>
</h2>
<p>The package <code>memoria</code> helps quantify how past and
concurrent events shape the state of a system. This concept is
summarized in the figure below:</p>
<p><img src="ecological_memory.png" alt="Ecological Memory"> The blue
and green curves represent the values of a biotic response
<code>y</code> and a driver <code>x</code> over time. The vertical line
<code>T</code> represents the <em>current</em> time, while
<code>T - lag</code> represents a a previous time. The arrows represent
<em>influence</em>, as follows:</p>
<ul>
<li>
<strong>Endogenous memory</strong>: is the effect of past
<code>y</code> on present <code>y</code>.</li>
<li>
<strong>Exogenous memory</strong>: is the effect of past
<code>x</code> on present <code>y</code>.</li>
<li>
<strong>Concurrent effect</strong>: is the effect of present
<code>x</code> on present <code>y</code>.</li>
</ul>
<p>To assess these effects, <code>memoria</code> generates the lagged
data and trains the model</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>T</mi></msub><mo>=</mo><msub><mi>y</mi><mrow><mi>T</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>y</mi><mrow><mi>T</mi><mo>−</mo><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>x</mi><mi>T</mi></msub><mo>+</mo><msub><mi>x</mi><mrow><mi>T</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>x</mi><mrow><mi>T</mi><mo>−</mo><mi>n</mi></mrow></msub><mo>+</mo><msub><mi>r</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">y_{T} = y_{T-1} + \ldots + y_{T-n} + x_{T} + x_{T-1} + \ldots + x_{T-n} + r_{T}</annotation></semantics></math></p>
<p>Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
are the response and the driver.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the “current” time, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t-1</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">t-n</annotation></semantics></math>,
are the time lags.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>T</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>y</mi><mrow><mi>T</mi><mo>−</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">y_{T-1} + \ldots + y_{T-n}</annotation></semantics></math>
represents the <strong>endogenous memory</strong> across lags.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>T</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>…</mi><mo>+</mo><msub><mi>x</mi><mrow><mi>T</mi><mo>−</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{T-1} + \ldots + x_{T-n}</annotation></semantics></math>
represents the <strong>exogenous memory</strong> across lags.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>T</mi></msub><annotation encoding="application/x-tex">x_{T}</annotation></semantics></math>
represents the <strong>concurrent effect</strong>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>T</mi></msub><annotation encoding="application/x-tex">r_{T}</annotation></semantics></math>
is a random term used to assess statistical significance.</li>
</ul>
<p>The ecological memory pattern is quantified using <strong>permutation
importance</strong> from Random Forest models. For each predictor, the
algorithm shuffles its values and measures the decrease in predictive
accuracy—larger decreases indicate stronger influence on the
response.</p>
<div class="float">
<img src="memory_plot.png" alt="Ecological Memory"><div class="figcaption">Ecological Memory</div>
</div>
<p>The following sections demonstrate how to implement this workflow in
R using the <code>memoria</code> package.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://blasbenito.github.io/memoria/">memoria</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="merge-datasets">Merge datasets<a class="anchor" aria-label="anchor" href="#merge-datasets"></a>
</h3>
<p>The <code><a href="../reference/mergePalaeoData.html">mergePalaeoData()</a></code> function aligns and interpolates
datasets sampled at different resolutions. Consider two built-in
datasets:</p>
<ul>
<li>
<strong>pollen</strong>: 639 samples with four pollen types (Pinus,
Quercus, Poaceae, Artemisia)</li>
<li>
<strong>climate</strong>: 800 samples with climate variables
(temperature, rainfall, etc.)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pollen</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">pollen</span>, <span class="va">pollen.type</span>, <span class="va">pollen.abundance</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">pollen.abundance</span>, group <span class="op">=</span> <span class="va">pollen.type</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">pollen.type</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Age (ky BP)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Pollen counts"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Pollen dataset"</span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_memoria_files/figure-html/plot-pollen-1.png" class="r-plt" alt="" width="100%"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">climate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">climate</span>, <span class="va">variable</span>, <span class="va">value</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Age (ky BP)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Palaeoclimatic data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_memoria_files/figure-html/plot-climate-1.png" class="r-plt" alt="" width="100%"></p>
<p>Merge and interpolate into a regular time grid:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pollen_climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mergePalaeoData.html">mergePalaeoData</a></span><span class="op">(</span></span>
<span>  datasets.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pollen <span class="op">=</span> <span class="va">pollen</span>,</span>
<span>    climate <span class="op">=</span> <span class="va">climate</span></span>
<span>  <span class="op">)</span>,</span>
<span>  time.column <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>  interpolation.interval <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Argument interpolation.interval is set to 0.2</span></span>
<span><span class="co">#&gt; The average temporal resolution of pollen is 1.27; you are incrementing data resolution by a factor of 6.35</span></span>
<span><span class="co">#&gt; The average temporal resolution of climate is 1; you are incrementing data resolution by a factor of 5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pollen_climate</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    3993 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;  $ age                            : num  0.5 0.7 0.9 1.1 1.3 1.5 1.7 1.9 2.1 2.3 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus                   : num  0 2.5 6.97 10.64 13.39 ...</span></span>
<span><span class="co">#&gt;  $ pollen.quercus                 : num  95.6 109.4 120.1 127.7 132.6 ...</span></span>
<span><span class="co">#&gt;  $ pollen.poaceae                 : num  0 9.55 16.79 21.76 24.76 ...</span></span>
<span><span class="co">#&gt;  $ pollen.artemisia               : num  0 0 0.672 1.696 2.516 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage     : num  14.1 14.1 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage        : num  1.57 1.57 1.57 1.57 1.57 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureWarmestMonth: num  21 21.3 21.5 21.7 21.8 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureColdestMonth: num  5.25 5.24 5.23 5.22 5.2 ...</span></span>
<span><span class="co">#&gt;  $ climate.oxigenIsotope          : num  3.43 3.43 3.43 3.44 3.44 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">pollen_climate</span>, <span class="va">variable</span>, <span class="va">value</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Age (ky BP)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Pollen and palaeoclimate (merged)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_memoria_files/figure-html/merge-data-1.png" class="r-plt" alt="" width="100%"></p>
</div>
<div class="section level3">
<h3 id="create-lagged-data">Create lagged data<a class="anchor" aria-label="anchor" href="#create-lagged-data"></a>
</h3>
<p>The <code><a href="../reference/prepareLaggedData.html">prepareLaggedData()</a></code> function organizes data into the
lag structure required by the model. Each sample of the response is
aligned with antecedent values of itself and the drivers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pollen_climate_lagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepareLaggedData.html">prepareLaggedData</a></span><span class="op">(</span></span>
<span>  input.data <span class="op">=</span> <span class="va">pollen_climate</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"pollen.pinus"</span>,</span>
<span>  drivers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"climate.temperatureAverage"</span>, <span class="st">"climate.rainfallAverage"</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>  oldest.sample <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pollen_climate_lagged</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    3988 obs. of  19 variables:</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__0                : num  0 2.5 6.97 10.64 13.39 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__0.2              : num  2.5 6.97 10.64 13.39 15.02 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__0.4              : num  6.97 10.64 13.39 15.02 15.62 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__0.6              : num  10.6 13.4 15 15.6 14.5 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__0.8              : num  13.4 15 15.6 14.5 10.9 ...</span></span>
<span><span class="co">#&gt;  $ pollen.pinus__1                : num  15 15.6 14.5 10.9 6 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__0  : num  14.1 14.1 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__0.2: num  14.1 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__0.4: num  14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__0.6: num  14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__0.8: num  14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.temperatureAverage__1  : num  14 14 14 14 14 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__0     : num  1.57 1.57 1.57 1.57 1.57 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__0.2   : num  1.57 1.57 1.57 1.57 1.57 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__0.4   : num  1.57 1.57 1.57 1.57 1.57 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__0.6   : num  1.57 1.57 1.57 1.57 1.57 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__0.8   : num  1.57 1.57 1.57 1.57 1.56 ...</span></span>
<span><span class="co">#&gt;  $ climate.rainfallAverage__1     : num  1.57 1.57 1.57 1.56 1.56 ...</span></span>
<span><span class="co">#&gt;  $ time                           : num  0.5 0.7 0.9 1.1 1.3 1.5 1.7 1.9 2.1 2.3 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "response")= chr "pollen.pinus"</span></span>
<span><span class="co">#&gt;  - attr(*, "drivers")= chr [1:2] "climate.temperatureAverage" "climate.rainfallAverage"</span></span>
<span></span>
<span><span class="co"># Check attributes (used by computeMemory for auto-detection)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pollen_climate_lagged</span>, <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "pollen.pinus"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pollen_climate_lagged</span>, <span class="st">"drivers"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "climate.temperatureAverage" "climate.rainfallAverage"</span></span></code></pre></div>
<p><strong>Note on <code>oldest.sample</code>:</strong> Set to
<code>"last"</code> when the oldest sample is at the bottom of the
dataframe (typical palaeoecological convention). Set to
<code>"first"</code> if the oldest sample is at the top.</p>
<p>The output columns follow a naming convention:</p>
<ul>
<li>
<code>pollen.pinus__0</code>: Current response value</li>
<li>
<code>pollen.pinus__0.2</code>, <code>pollen.pinus__0.4</code>,
etc.: Endogenous terms</li>
<li>
<code>climate.temperatureAverage__0</code>,
<code>climate.temperatureAverage__0.2</code>, etc.: Concurrent effect
and exogenous terms</li>
</ul>
</div>
<div class="section level3">
<h3 id="compute-memory">Compute memory<a class="anchor" aria-label="anchor" href="#compute-memory"></a>
</h3>
<p>The <code><a href="../reference/computeMemory.html">computeMemory()</a></code> function fits Random Forest models
on the lagged data. It measures variable importance using permutation,
which is robust to multicollinearity and temporal autocorrelation.</p>
<p>Two benchmark modes are available for significance testing:</p>
<ul>
<li>
<code>"white.noise"</code>: Random values without temporal structure
(faster)</li>
<li>
<code>"autocorrelated"</code>: Random walk with temporal structure
(more conservative, recommended)</li>
</ul>
<p>The model runs multiple times (<code>repetitions</code>),
regenerating the random term each time, then computes percentiles of
importance scores.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simplified call - response and drivers auto-detected from lagged data attributes</span></span>
<span><span class="va">memory_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeMemory.html">computeMemory</a></span><span class="op">(</span></span>
<span>  lagged.data <span class="op">=</span> <span class="va">pollen_climate_lagged</span>,</span>
<span>  random.mode <span class="op">=</span> <span class="st">"white.noise"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output structure (5 slots)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">memory_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "response"   "drivers"    "memory"     "R2"         "prediction"</span></span>
<span></span>
<span><span class="co"># Memory dataframe (lowercase column names: variable, lag)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">memory_output</span><span class="op">$</span><span class="va">memory</span><span class="op">)</span></span>
<span><span class="co">#&gt;     median        sd      min      max                   variable lag</span></span>
<span><span class="co">#&gt; 1 40.68684 1.0008733 39.36679 42.42693               pollen.pinus 0.2</span></span>
<span><span class="co">#&gt; 2 25.25720 0.7842455 24.07659 26.52628               pollen.pinus 0.4</span></span>
<span><span class="co">#&gt; 3 17.18441 0.9590776 15.63918 18.74209               pollen.pinus 0.6</span></span>
<span><span class="co">#&gt; 4 15.57412 1.4198263 13.37104 18.24264               pollen.pinus 0.8</span></span>
<span><span class="co">#&gt; 5 18.78565 1.0239717 16.99415 20.41879               pollen.pinus 1.0</span></span>
<span><span class="co">#&gt; 6 18.53973 1.8083562 15.58879 21.22939 climate.temperatureAverage 0.0</span></span>
<span></span>
<span><span class="co"># Pseudo R-squared</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">memory_output</span><span class="op">$</span><span class="va">R2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9910341 0.9910674 0.9909211 0.9908772 0.9909376 0.9908922</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="../reference/plotMemory.html">plotMemory</a></span><span class="op">(</span><span class="va">memory_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_memoria_files/figure-html/compute-memory-whitenoise-1.png" class="r-plt" alt="" width="100%"></p>
<p>Now with autocorrelated random mode (more stringent):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">memory_output_autocor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeMemory.html">computeMemory</a></span><span class="op">(</span></span>
<span>  lagged.data <span class="op">=</span> <span class="va">pollen_climate_lagged</span>,</span>
<span>  random.mode <span class="op">=</span> <span class="st">"autocorrelated"</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotMemory.html">plotMemory</a></span><span class="op">(</span><span class="va">memory_output_autocor</span><span class="op">)</span></span></code></pre></div>
<p><img src="working_with_memoria_files/figure-html/compute-memory-autocor-1.png" class="r-plt" alt="" width="100%"></p>
<p>Notice the yellow band (random benchmark) is higher with
autocorrelated mode, providing a more conservative significance
threshold.</p>
</div>
<div class="section level3">
<h3 id="extract-memory-features">Extract memory features<a class="anchor" aria-label="anchor" href="#extract-memory-features"></a>
</h3>
<p>The <code><a href="../reference/extractMemoryFeatures.html">extractMemoryFeatures()</a></code> function summarizes memory
patterns into quantitative features:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">memory_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extractMemoryFeatures.html">extractMemoryFeatures</a></span><span class="op">(</span></span>
<span>  memory.pattern <span class="op">=</span> <span class="va">memory_output_autocor</span>,</span>
<span>  exogenous.component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"climate.temperatureAverage"</span>,</span>
<span>    <span class="st">"climate.rainfallAverage"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  endogenous.component <span class="op">=</span> <span class="st">"pollen.pinus"</span>,</span>
<span>  sampling.subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale.strength <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">memory_features</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="14%">
<col width="13%">
<col width="14%">
<col width="12%">
<col width="12%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="right">label</th>
<th align="right">strength.endogenous</th>
<th align="right">strength.exogenous</th>
<th align="right">strength.concurrent</th>
<th align="right">length.endogenous</th>
<th align="right">length.exogenous</th>
<th align="right">dominance.endogenous</th>
<th align="right">dominance.exogenous</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">1</td>
<td align="right">21.27227</td>
<td align="right">0</td>
<td align="right">-0.8896378</td>
<td align="right">0.4</td>
<td align="right">0</td>
<td align="right">0.4</td>
<td align="right">0</td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-output">Understanding the Output<a class="anchor" aria-label="anchor" href="#understanding-the-output"></a>
</h2>
<div class="section level3">
<h3 id="significance-testing">Significance testing<a class="anchor" aria-label="anchor" href="#significance-testing"></a>
</h3>
<p>Random Forest provides importance scores but no built-in significance
test. The solution is to add a random benchmark variable: if a
predictor’s importance equals or falls below the random variable’s
importance, we cannot distinguish its contribution from noise.</p>
<p>In plots, predictors with importance above the yellow band (random
median) are considered significant. The width of the band reflects
uncertainty across model repetitions.</p>
<p>The autocorrelated benchmark is recommended for palaeoecological
analysis because it accounts for the temporal structure inherent in
these datasets.</p>
</div>
<div class="section level3">
<h3 id="memory-features">Memory features<a class="anchor" aria-label="anchor" href="#memory-features"></a>
</h3>
<p>The extracted features quantify three aspects of ecological
memory:</p>
<ul>
<li><p><strong>Strength</strong>: Maximum importance difference between
a component and the random median. Higher values indicate stronger
memory effects. Computed for endogenous, exogenous, and concurrent
components.</p></li>
<li><p><strong>Length</strong>: Proportion of lags where importance
exceeds the random median. Values near 1 indicate persistent memory
across all lags. Computed for endogenous and exogenous components
only.</p></li>
<li><p><strong>Dominance</strong>: Among significant lags, the
proportion where one component (endogenous or exogenous) exceeds the
other. Values near 1 indicate one component dominates; values near 0.5
indicate balance.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="batch-experiments">Batch Experiments<a class="anchor" aria-label="anchor" href="#batch-experiments"></a>
</h2>
<p>The memoria package includes functions for batch analysis of
simulated pollen curves from the <a href="https://github.com/BlasBenito/virtualPollen" class="external-link">virtualPollen</a>
package:</p>
<ul>
<li>
<code><a href="../reference/runExperiment.html">runExperiment()</a></code>: Apply the full workflow across
multiple simulations</li>
<li>
<code><a href="../reference/experimentToTable.html">experimentToTable()</a></code>: Reshape experiment results into
long format</li>
<li>
<code><a href="../reference/plotExperiment.html">plotExperiment()</a></code>: Visualize memory patterns across
parameter combinations</li>
</ul>
<p>These functions enable systematic exploration of how ecological
memory varies with species traits and sampling resolution. The
virtualPollen package must be installed separately from GitHub
(<code>devtools::install_github("BlasBenito/virtualPollen")</code>).</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The complete workflow:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/mergePalaeoData.html">mergePalaeoData()</a></code> - Align datasets with different
resolutions</li>
<li>
<code><a href="../reference/prepareLaggedData.html">prepareLaggedData()</a></code> - Create lag structure</li>
<li>
<code><a href="../reference/computeMemory.html">computeMemory()</a></code> - Fit Random Forest and compute
importance</li>
<li>
<code><a href="../reference/plotMemory.html">plotMemory()</a></code> - Visualize the memory pattern</li>
<li>
<code><a href="../reference/extractMemoryFeatures.html">extractMemoryFeatures()</a></code> - Quantify memory
characteristics</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Blas M. Benito.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
